<!-- In this example, there are two accordion items. The first accordion item contains a nested accordion within its
accordion body. Notice how the nested accordion has its own ID (nestedAccordionX) and the data-bs-parent attribute is
set to #nestedAccordionX. This ensures that the nested accordion operates independently within the parent accordion
item.

The outer accordion's data-bs-parent attribute is set to #accordion, which is the ID of the outer accordion container.
This establishes the relationship between the outer accordion and its child accordion items.

By following this nested structure and setting the appropriate data-bs-parent attributes, you can create nested
accordions within Bootstrap 5. 
 -->


<!-- CSS CLASSES:
            accordion - for the accordion container
            accordion-item - for each accordion item
            accordion-header - for the header element
            accordion-body - for the body element
            accordion-collapse - to define the collapsing behavior 
        -->

<div class="accordion" id="accordionExample">
    <!-- this is the outermost container. typically has an ID, and serves as the PARENT. -->





    <!-- ./ close accordion -->
</div>


<script>
    // JS HTML DOM document object is the owner of all other objects in page
    // .ready() offers a way to run JS code as soon as page's (DOM) becomes safe to manipulate.
    // Ready Click and Ajax are all functions of jQuery
    let completeMenu = [];
    const menuCategories = ["Sandwiches", "Poke Bowls", "Salads"];
    var sandwichMenu, pokebowlMenu, saladMenu;
    function generateAccordionItems(menuData, category) {
        let nestedAccordionItems;
        let index;

        if (category === "PokeBowls") {
            index = 1;
        } else if (category === "Sandwiches") {
            index = 0;
        } else if (category === "Salads") {
            index = 2;
        } else {
            index = "Placeholder";
        }


        console.log(menuData);

        menuData.forEach((item, index) => {


            console.log(item[3]);

            // Generate the nested accordion item content
            const itemContent = `
        <div class="accordion-item">
          <h2 class="accordion-header" id="nestedHeading${index}">
            <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#nestedCollapse${index}" aria-expanded="true" aria-controls="nestedCollapse${index}">
              ${item.ItemName}
            </button>
          </h2>
          <div id="nestedCollapse${index}" class="accordion-collapse collapse" aria-labelledby="nestedHeading${index}" data-bs-parent="#nestedAccordion${category}${index}">
            <div class="accordion-body">
              <p>${item.Ingredients}</p>
              <p>Price: ${item.LocalIngredients}</p>
              <p>Allergens: ${item.Allergens}</p>
              <p>Dietary: ${item.Diet}</p>
              <p>Nutrition Label: ${item.nutritionLabel ? item.nutritionLabel : 'N/A'}</p>
            </div>
          </div>
        </div>
      `;

            nestedAccordionItems += itemContent;

        });


        //Generate parent category container and interpolate with nested.


        const itemContent = `
<div class="accordion-item">
    <h2 class="accordion-header" id="heading${index}">
        <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#collapse${index}"
            aria-expanded="true" aria-controls="collapse${index}">
            ${category}
        </button>
    </h2>
    <div id="collapse${index}" class="accordion-collapse collapse" aria-labelledby="heading${index}"
        data-bs-parent="#accordionExample">
        <div class="accordion-body">
            <div id="nestedAccordion${category}${index}">
                <!-- Nested accordion items will be dynamically generated here -->
                ${nestedAccordionItems}

            </div>
        </div>
    </div>
</div>
`;



        // Append the nested accordion items to the corresponding nested accordion container

        document.getElementById('accordionExample').innerHTML += itemContent;
    }






    function loadMenus() {
        $(document).ready(function () {

            // Fetch Sandwich data from the sandwich file
            $.ajax({
                url: "./files/menus/green_mountain/sandwiches_greenmountain.csv",
                dataType: "text",
                success: function (data) {

                    const category = "Sandwiches";
                    // Process the data and assign it to completeMenu
                    // Split CSV data into rows
                    const rows = data.split('\n');

                    // Extract headers from the first row
                    const headers = rows[0].split(';');

                    // Convert CSV data to JSON
                    const jsonData = [];
                    for (let i = 1; i < rows.length - 1; i++) {
                        const columns = rows[i].split(';');
                        const rowObject = {};

                        for (let j = 0; j < headers.length; j++) {
                            rowObject[headers[j]] = columns[j];
                        }

                        jsonData.push(rowObject);

                        // Check for empty cells and alert if critical data is missing.
                        for (let j = 0; j < headers.length; j++) {


                            let columnValue = "";

                            //We are allowing these cells to be empty, 
                            //but we want to assign specific placeholder values to each.
                            if (j === 2 && rowObject[headers[j]] === "") {
                                columnValue = "No known priority allergens."; // Use empty string if cell is empty
                                rowObject[headers[j]] = columnValue;

                                break;


                            }

                            if (j === 3 || j === 4) {

                                switch (j) {

                                    case 3:
                                        // Code to execute when dietary info is empty.
                                        columnValue = "NA"; // Use empty string if cell is empty
                                        rowObject[headers[j]] = columnValue;
                                        break;

                                    default:
                                        // Code to execute when none of the options match
                                        columnValue = "";

                                        break;
                                }

                                continue;
                            }

                            columnValue = columns[j] || ""; // Use empty string if cell is empty
                            rowObject[headers[j]] = columnValue;

                            if (columnValue.trim() === "") {
                                alert(`Empty cell found at row ${i + 1}, column ${j + 1}`);
                            }
                        }
                    }

                    sandwichMenu = jsonData;
                    console.log(sandwichMenu);
                    completeMenu.length = 0;
                    completeMenu.push(generateAccordionItems(sandwichMenu, category));
                    console.log(`We just pushed Sandwiches to COMPLETE menu:  ${completeMenu}`);

                    sandwichMenu = completeMenu;




                },
            });

            // Fetch Poke Bowl data from the pokebowl file
            $.ajax({
                url: "./files/menus/green_mountain/pokebowls_greenmountain.csv",
                dataType: "text",
                success: function (data) {

                    const category = "PokeBowls";
                    // Process the data and assign it to completeMenu
                    // Split CSV data into rows
                    const rows = data.split('\n');

                    // Extract headers from the first row
                    const headers = rows[0].split(';');

                    // Convert CSV data to JSON
                    const jsonData = [];
                    for (let i = 1; i < rows.length - 1; i++) {
                        const columns = rows[i].split(';');
                        const rowObject = {};

                        for (let j = 0; j < headers.length; j++) {
                            rowObject[headers[j]] = columns[j];
                        }

                        jsonData.push(rowObject);

                        // Check for empty cells and alert if critical data is missing.
                        for (let j = 0; j < headers.length; j++) {


                            let columnValue = "";

                            //We are allowing these cells to be empty, 
                            //but we want to assign specific placeholder values to each.
                            if (j === 2 && rowObject[headers[j]] === "") {
                                columnValue = "No known priority allergens."; // Use empty string if cell is empty
                                rowObject[headers[j]] = columnValue;

                                break;


                            }

                            if (j === 3 || j === 4) {

                                switch (j) {

                                    case 3:
                                        // Code to execute when dietary info is empty.
                                        columnValue = "NA"; // Use empty string if cell is empty
                                        rowObject[headers[j]] = columnValue;
                                        break;

                                    default:
                                        // Code to execute when none of the options match
                                        columnValue = "";

                                        break;
                                }

                                continue;
                            }

                            columnValue = columns[j] || ""; // Use empty string if cell is empty
                            rowObject[headers[j]] = columnValue;

                            if (columnValue.trim() === "") {
                                alert(`Empty cell found at row ${i + 1}, column ${j + 1}`);
                            }
                        }
                    }

                    pokebowlMenu = jsonData;
                    completeMenu.length = 0;
                    completeMenu.push(generateAccordionItems(pokebowlMenu, category));
                    pokebowlMenu = completeMenu;

                },
            });

            // Fetch Salads data from the salad file
            $.ajax({
                url: "./files/menus/green_mountain/salads_greenmountain.csv",
                dataType: "text",
                success: function (data) {

                    const category = "Salads";
                    // Process the data and assign it to completeMenu
                    // Split CSV data into rows
                    const rows = data.split('\n');

                    // Extract headers from the first row
                    const headers = rows[0].split(';');

                    // Convert CSV data to JSON
                    const jsonData = [];
                    for (let i = 1; i < rows.length - 1; i++) {
                        const columns = rows[i].split(';');
                        const rowObject = {};

                        for (let j = 0; j < headers.length; j++) {
                            rowObject[headers[j]] = columns[j];
                        }

                        jsonData.push(rowObject);

                        // Check for empty cells and alert if critical data is missing.
                        for (let j = 0; j < headers.length; j++) {


                            let columnValue = "";

                            //We are allowing these cells to be empty, 
                            //but we want to assign specific placeholder values to each.
                            if (j === 2 && rowObject[headers[j]] === "") {
                                columnValue = "No known priority allergens."; // Use empty string if cell is empty
                                rowObject[headers[j]] = columnValue;

                                break;


                            }

                            if (j === 3 || j === 4) {

                                switch (j) {

                                    case 3:
                                        // Code to execute when dietary info is empty.
                                        columnValue = "NA"; // Use empty string if cell is empty
                                        rowObject[headers[j]] = columnValue;
                                        break;

                                    default:
                                        // Code to execute when none of the options match
                                        columnValue = "";

                                        break;
                                }

                                continue;
                            }

                            columnValue = columns[j] || ""; // Use empty string if cell is empty
                            rowObject[headers[j]] = columnValue;

                            if (columnValue.trim() === "") {
                                alert(`Empty cell found at row ${i + 1}, column ${j + 1}`);
                            }
                        }
                    }

                    saladMenu = jsonData;


                    //clear the menu object
                    completeMenu.length = 0;
                    //push to the menu object and save it as the menu
                    completeMenu.push(generateAccordionItems(saladMenu, category));
                    saladMenu = completeMenu;


                },
            });



        });


    }

    loadMenus();











</script>